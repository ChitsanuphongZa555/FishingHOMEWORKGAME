<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üé£ Fishing Quiz (Prob)</title>
  <style>
    :root{
      --bg:#071427;
      --panel:#0b1d3a;
      --text:#eaf2ff;
      --muted:#9db3d6;
      --good:#4ade80;
      --warn:#fbbf24;
      --bad:#fb7185;
      --btn:#ffffff10;
      --btn2:#3b82f620;
      --border:#ffffff15;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans Thai", sans-serif;
      background: radial-gradient(1200px 600px at 50% -20%, #1b4aa8 0%, var(--bg) 55%);
      color:var(--text);
      padding:12px;
      display:flex;
      justify-content:center;
    }
    .wrap{width:min(980px,100%)}
    header{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      margin-bottom:10px;
    }
    h1{margin:0; font-size:18px}
    .sub{color:var(--muted); font-size:12px; line-height:1.3}
    .grid{
      display:grid;
      grid-template-columns: 1.25fr .75fr;
      gap:10px;
    }
    @media (max-width: 860px){ .grid{grid-template-columns:1fr} }
    .card{
      background: linear-gradient(180deg, rgba(11,29,58,.92), rgba(7,20,39,.92));
      border:1px solid var(--border);
      border-radius:14px;
      box-shadow: 0 18px 60px rgba(0,0,0,.35);
      overflow:hidden;
    }
    .canvasBox{padding:10px}
    canvas{
      width:100%;
      height:auto;
      border-radius:12px;
      border:1px solid var(--border);
      background: linear-gradient(180deg, #001629 0%, #043a61 50%, #0a78b8 100%);
      display:block;
      touch-action: manipulation;
    }
    .side{padding:12px}
    .stats{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
      margin-bottom:10px;
    }
    .stat{
      background: rgba(255,255,255,.05);
      border:1px solid var(--border);
      border-radius:12px;
      padding:10px;
    }
    .k{font-size:12px; color:var(--muted)}
    .v{font-size:18px; font-weight:800; margin-top:4px}
    .panel{
      background: rgba(255,255,255,.05);
      border:1px solid var(--border);
      border-radius:12px;
      padding:10px;
      margin-bottom:10px;
    }
    .row{display:flex; justify-content:space-between; align-items:center; gap:10px}
    .btns{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
    button{
      appearance:none;
      border:1px solid var(--border);
      background: var(--btn);
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      font-weight:800;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    button.primary{ background: var(--btn2); border-color: #3b82f650; }
    button.danger{ background: rgba(251,113,133,.12); border-color: rgba(251,113,133,.4); }
    button:disabled{ opacity:.45; cursor:not-allowed; }

    .meter{
      margin-top:8px;
      height:12px;
      background: rgba(255,255,255,.08);
      border:1px solid var(--border);
      border-radius:999px;
      overflow:hidden;
    }
    .fill{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, var(--good), var(--warn), var(--bad));
      transition: width .08s linear;
    }
    .log{
      font-size:12px;
      color:var(--muted);
      min-height:70px;
      white-space:pre-line;
      line-height:1.35;
    }
    .hint{font-size:12px; color:var(--muted); margin-top:8px}
    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 11px;
      background: rgba(255,255,255,.08);
      border:1px solid var(--border);
      padding:2px 6px;
      border-radius:8px;
      color: var(--text);
    }

    .overlay{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      padding:14px;
      background: rgba(0,0,0,0.55);
      backdrop-filter: blur(4px);
      z-index: 9999;
    }
    .overlay.show{ display:flex; }
    .modal{
      width: min(680px, 100%);
      background: linear-gradient(180deg, rgba(11,29,58,.96), rgba(7,20,39,.96));
      border:1px solid var(--border);
      border-radius:16px;
      box-shadow: 0 18px 80px rgba(0,0,0,.45);
      padding:14px;
    }
    .modal h2{ margin:0 0 6px; font-size:16px; }
    .badge{
      display:inline-block;
      font-size:12px;
      color: var(--muted);
      border:1px solid var(--border);
      background: rgba(255,255,255,.06);
      padding:4px 8px;
      border-radius:999px;
      margin-bottom:10px;
    }
    .qtext{ font-size:14px; line-height:1.4; margin:8px 0 12px; }
    .choices{
      display:grid;
      grid-template-columns: 1fr;
      gap:8px;
      margin-top:10px;
    }
    .choiceBtn{
      text-align:left;
      background: rgba(255,255,255,.06);
      border:1px solid var(--border);
      border-radius:14px;
      padding:12px;
      font-weight:800;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }
    .choiceBtn:active{ transform: translateY(1px); }
    .modal .foot{
      margin-top:10px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      color: var(--muted);
      font-size:12px;
    }
    .winTitle{
      font-size:18px;
      font-weight:900;
      margin: 0 0 6px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>üé£ Fishing + Quiz (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô)</h1>
        <div class="sub">
          ‡∏™‡∏∏‡πà‡∏°‡∏õ‡∏•‡∏≤‡πÅ‡∏ö‡∏ö 10 ‡∏™‡πà‡∏ß‡∏ô: ‡∏õ‡∏•‡∏≤‡∏ó‡∏≠‡∏á 1/10 | ‡∏õ‡∏•‡∏≤‡πÄ‡∏á‡∏¥‡∏ô 2/10 | ‡∏õ‡∏•‡∏≤‡∏ó‡∏≠‡∏á‡πÅ‡∏î‡∏á 3/10 | ‡∏õ‡∏•‡∏≤‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤ 4/10
          <br/>‡∏Ñ‡∏µ‡∏¢‡πå‡∏•‡∏±‡∏î: <span class="kbd">C</span> Cast, <span class="kbd">R</span> Reel (Toggle)
        </div>
      </div>
      <div class="sub" id="stateText">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ï‡∏Å‡∏õ‡∏•‡∏≤</div>
    </header>

    <div class="grid">
      <div class="card">
        <div class="canvasBox">
          <canvas id="game" width="900" height="520" aria-label="Fishing Game Canvas"></canvas>
        </div>
      </div>

      <div class="card">
        <div class="side">
          <div class="stats">
            <div class="stat">
              <div class="k">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡∏ä‡∏ô‡∏∞‡∏ó‡∏µ‡πà 5)</div>
              <div class="v"><span id="score">0</span> / 5</div>
            </div>
            <div class="stat">
              <div class="k">‡∏õ‡∏•‡∏≤‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤ üêü (4/10)</div>
              <div class="v" id="normalCount">0</div>
            </div>
            <div class="stat">
              <div class="k">‡∏õ‡∏•‡∏≤‡πÄ‡∏á‡∏¥‡∏ô üêü (2/10)</div>
              <div class="v" id="fishACount">0</div>
            </div>
            <div class="stat">
              <div class="k">‡∏õ‡∏•‡∏≤‡∏ó‡∏≠‡∏á‡πÅ‡∏î‡∏á üê† (3/10)</div>
              <div class="v" id="fishBCount">0</div>
            </div>
            <div class="stat">
              <div class="k">‡∏õ‡∏•‡∏≤‡∏ó‡∏≠‡∏á üê† (1/10)</div>
              <div class="v" id="goldCount">0</div>
            </div>
            <div class="stat">
              <div class="k">‡∏à‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
              <div class="v" id="totalCount">0</div>
            </div>
          </div>

          <div class="panel">
            <div class="row">
              <div>
                <div class="k">‡πÅ‡∏£‡∏á‡∏ï‡∏∂‡∏á‡∏™‡∏≤‡∏¢ (Tension)</div>
                <div class="sub">‡∏ï‡∏∂‡∏á‡πÄ‡∏Å‡∏¥‡∏ô = ‡∏™‡∏≤‡∏¢‡∏Ç‡∏≤‡∏î</div>
              </div>
              <div style="font-weight:900" id="tensionLabel">0%</div>
            </div>
            <div class="meter"><div class="fill" id="tensionFill"></div></div>

            <div class="btns">
              <button class="primary" id="castBtn">üéØ Cast</button>
              <button class="primary" id="reelBtn" disabled>üåÄ Reel</button>
              <button class="danger" id="resetBtn">‚Üª Reset</button>
            </div>

            <div class="hint">
              ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ‚Äú‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‚Äù ‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ 5 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏ô‡∏∞
              <br/>‡∏ó‡∏¥‡∏õ: ‡∏Ñ‡∏•‡∏¥‡∏Å Reel 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á = ‡∏Ñ‡πâ‡∏≤‡∏á ON (‡∏Ñ‡∏•‡∏¥‡∏Å‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á = OFF)
            </div>
          </div>

          <div class="panel">
            <div class="k">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</div>
            <div class="log" id="log">- ‡∏Å‡∏î Cast ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Quiz overlay -->
  <div class="overlay" id="quizOverlay" role="dialog" aria-modal="true">
    <div class="modal">
      <div class="badge" id="quizBadge">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</div>
      <h2 id="quizTitle">‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h2>
      <div class="qtext" id="quizQuestion">...</div>
      <div class="choices" id="quizChoices"></div>
      <div class="foot">
        <div id="quizHint">‚è±Ô∏è ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏ß‡∏•‡∏≤: <b id="quizTime">45</b> ‡∏ß‡∏¥ | ‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å = +1 | ‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î/‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤/‡∏Ç‡πâ‡∏≤‡∏° = 0</div>
        <div style="display:flex; gap:8px; align-items:center;">
          <button id="skipBtn" class="choiceBtn" style="padding:10px 12px;">Skip</button>
          <div id="quizResult"></div>
        </div>
      </div>
    </div>
  </div>

<script>
(() => {
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');

  function fitCanvas() {
    const cssW = canvas.clientWidth || 900;
    const ratio = window.devicePixelRatio || 1;
    const targetW = Math.floor(cssW * ratio);
    const targetH = Math.floor((cssW * (520/900)) * ratio);
    canvas.width = targetW;
    canvas.height = targetH;
  }
  window.addEventListener('resize', fitCanvas);
  fitCanvas();

  const castBtn = document.getElementById('castBtn');
  const reelBtn = document.getElementById('reelBtn');
  const resetBtn = document.getElementById('resetBtn');

  const scoreEl = document.getElementById('score');
  const normalEl = document.getElementById('normalCount');
  const fishAEl = document.getElementById('fishACount');
  const fishBEl = document.getElementById('fishBCount');
  const goldEl = document.getElementById('goldCount');
  const totalEl = document.getElementById('totalCount');

  const logEl = document.getElementById('log');
  const stateText = document.getElementById('stateText');
  const tensionFill = document.getElementById('tensionFill');
  const tensionLabel = document.getElementById('tensionLabel');

  const quizOverlay = document.getElementById('quizOverlay');
  const quizBadge = document.getElementById('quizBadge');
  const quizTitle = document.getElementById('quizTitle');
  const quizQuestion = document.getElementById('quizQuestion');
  const quizChoices = document.getElementById('quizChoices');
  const quizResult = document.getElementById('quizResult');
  const quizTimeEl = document.getElementById('quizTime');
  const skipBtn = document.getElementById('skipBtn');

  function log(msg){
    logEl.textContent = msg + "\n" + logEl.textContent.split("\n").slice(0,5).join("\n");
  }

  const ST = {
    IDLE: "IDLE",
    CASTING: "CASTING",
    WAITING: "WAITING",
    HOOKED: "HOOKED",
    LANDED: "LANDED",
    BROKE: "BROKE",
    QUIZ: "QUIZ",
    WIN: "WIN",
  };

  let state = ST.IDLE;

  let score = 0;
  let normalCount = 0;
  let fishACount = 0;
  let fishBCount = 0;
  let goldCount = 0;
  let totalCount = 0;

  const rod = { x: 130, y: 110 };
  let hook = { x: 220, y: 160, vy: 0 };

  const fishes = [];
  const waterLine = () => canvas.height * 0.28;

  let hookedFish = null;
  let targetType = null;
  let tension = 0;
  let waitTimer = 0;
  let castTimer = 0;
  let fishPull = 0;

  // ===== ‚úÖ Reel state (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç) =====
  let reelHeld = false;
  let reelToggle = false;

  function setReel(on){
    if (reelBtn.disabled) return;
    reelHeld = on;
    reelBtn.textContent = reelHeld ? "üåÄ Reel (ON)" : "üåÄ Reel";
  }

  function resetReel(){
    reelHeld = false;
    reelToggle = false;
    reelBtn.textContent = "üåÄ Reel";
  }

  function setState(s){
    state = s;

    // ‚úÖ ‡∏Å‡∏±‡∏ô ‚Äú‡∏Ñ‡πâ‡∏≤‡∏á/‡∏´‡∏•‡∏≠‡∏ô‚Äù ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
    resetReel();

    const map = {
      IDLE: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ï‡∏Å‡∏õ‡∏•‡∏≤",
      CASTING: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡πÄ‡∏´‡∏ß‡∏µ‡πà‡∏¢‡∏á‡πÄ‡∏ö‡πá‡∏î‚Ä¶",
      WAITING: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏£‡∏≠‡∏õ‡∏•‡∏≤‡∏Å‡∏¥‡∏ô‡πÄ‡∏´‡∏¢‡∏∑‡πà‡∏≠‚Ä¶",
      HOOKED: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏ï‡∏¥‡∏î‡∏õ‡∏•‡∏≤‡πÅ‡∏•‡πâ‡∏ß! Reel!",
      LANDED: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏à‡∏±‡∏ö‡πÑ‡∏î‡πâ! ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°",
      BROKE: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏™‡∏≤‡∏¢‡∏Ç‡∏≤‡∏î‚Ä¶ ‡∏Å‡∏î Cast ‡πÉ‡∏´‡∏°‡πà",
      QUIZ: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°",
      WIN: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏ä‡∏ô‡∏∞‡πÅ‡∏•‡πâ‡∏ß!",
    };
    stateText.textContent = map[s] || ("‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: " + s);

    if (s === ST.IDLE){
      castBtn.disabled = false;
      reelBtn.disabled = true;
    } else if (s === ST.CASTING || s === ST.WAITING){
      castBtn.disabled = true;
      reelBtn.disabled = true;
    } else if (s === ST.HOOKED){
      castBtn.disabled = true;
      reelBtn.disabled = false;
    } else if (s === ST.BROKE){
      castBtn.disabled = false;
      reelBtn.disabled = true;
    } else if (s === ST.QUIZ || s === ST.WIN || s === ST.LANDED){
      castBtn.disabled = true;
      reelBtn.disabled = true;
    }
  }

  function updateUI(){
    scoreEl.textContent = score;
    normalEl.textContent = normalCount;
    fishAEl.textContent = fishACount;
    fishBEl.textContent = fishBCount;
    goldEl.textContent = goldCount;
    totalEl.textContent = totalCount;
  }

  function updateTensionUI(){
    const pct = Math.max(0, Math.min(1, tension));
    tensionFill.style.width = Math.round(pct*100) + "%";
    tensionLabel.textContent = Math.round(pct*100) + "%";
  }

  function rollFishType(){
    const r = Math.floor(Math.random() * 10) + 1;
    if (r === 10) return "gold";
    if (r === 8 || r === 9) return "fishA";
    if (r === 5 || r === 6 || r === 7) return "fishB";
    return "normal";
  }

  function fishLabel(type){
    if (type === "gold") return "‡∏õ‡∏•‡∏≤‡∏ó‡∏≠‡∏á üê†";
    if (type === "fishA") return "‡∏õ‡∏•‡∏≤‡πÄ‡∏á‡∏¥‡∏ô üêü";
    if (type === "fishB") return "‡∏õ‡∏•‡∏≤‡∏ó‡∏≠‡∏á‡πÅ‡∏î‡∏á üê†";
    return "‡∏õ‡∏•‡∏≤‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤ üêü";
  }

  const QUIZ = {
    easy: [
      { q:"‡πÇ‡∏¢‡∏ô‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏≠‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£?", opts:["1/2","1/3","1/4"], a:0 },
      { q:"‡∏ó‡∏≠‡∏¢‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤ 1 ‡∏•‡∏π‡∏Å ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏π‡πà‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£?", opts:["1/2","1/3","2/3"], a:0 },
      { q:"‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏Ç‡∏à‡∏≤‡∏Å {1,2,3,4} 1 ‡∏ï‡∏±‡∏ß ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏Ç 1 ‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£?", opts:["1/4","1/2","3/4"], a:0 },
      { q:"‡∏´‡∏¢‡∏¥‡∏ö‡∏•‡∏π‡∏Å‡∏ö‡∏≠‡∏•‡∏à‡∏≤‡∏Å‡∏ñ‡∏∏‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ ‡πÅ‡∏î‡∏á 1 ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô 1 (‡∏£‡∏ß‡∏° 2) ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡πÑ‡∏î‡πâ‡∏™‡∏µ‡πÅ‡∏î‡∏á‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£?", opts:["1/2","1/3","2/3"], a:0 },
      { q:"‡∏ó‡∏≠‡∏¢‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤ 1 ‡∏•‡∏π‡∏Å ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏Ç‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 4 ‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£?", opts:["1/3","1/2","2/3"], a:0 },
    ],
    medium: [
      { q:"‡∏ó‡∏≠‡∏¢‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤ 1 ‡∏•‡∏π‡∏Å ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡πÑ‡∏î‡πâ 1 ‡∏´‡∏£‡∏∑‡∏≠ 2 ‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£?", opts:["1/3","1/2","2/3"], a:0 },
      { q:"‡πÇ‡∏¢‡∏ô‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç 2 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏≠‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£?", opts:["1/4","1/2","3/4"], a:0 },
      { q:"‡∏´‡∏¢‡∏¥‡∏ö‡∏•‡∏π‡∏Å‡∏ö‡∏≠‡∏• 1 ‡∏•‡∏π‡∏Å ‡∏à‡∏≤‡∏Å‡∏ñ‡∏∏‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ ‡πÅ‡∏î‡∏á 2 ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô 3 ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡πÑ‡∏î‡πâ‡∏™‡∏µ‡πÅ‡∏î‡∏á‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£?", opts:["2/5","3/5","1/5"], a:0 },
      { q:"‡∏ó‡∏≠‡∏¢‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤ 1 ‡∏•‡∏π‡∏Å ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏µ‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏Ç 6 ‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£?", opts:["2/3","1/2","1/3"], a:0 },
      { q:"‡∏™‡∏∏‡πà‡∏°‡∏Å‡∏≤‡∏£‡πå‡∏î 1 ‡πÉ‡∏ö‡∏à‡∏≤‡∏Å 10 ‡πÉ‡∏ö (‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏© 2 ‡πÉ‡∏ö) ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡πÑ‡∏î‡πâ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£?", opts:["2/10","1/5","3/10"], a:1 },
    ],
    hard: [
      { q:"‡∏ó‡∏≠‡∏¢‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤ 2 ‡∏•‡∏π‡∏Å ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô 7 ‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£?", opts:["1/6","1/12","1/9"], a:0 },
      { q:"‡πÇ‡∏¢‡∏ô‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç 3 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏≠‡∏≠‡∏Å‡∏´‡∏±‡∏ß ‚Äú‡∏û‡∏≠‡∏î‡∏µ 2 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‚Äù ‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£?", opts:["3/8","1/4","1/2"], a:0 },
      { q:"‡∏ó‡∏≠‡∏¢‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤ 2 ‡∏•‡∏π‡∏Å ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏Ç‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô (‡∏î‡∏±‡∏ö‡πÄ‡∏ö‡∏¥‡∏•) ‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£?", opts:["1/6","1/3","1/12"], a:0 },
      { q:"‡∏´‡∏¢‡∏¥‡∏ö‡∏•‡∏π‡∏Å‡∏ö‡∏≠‡∏• 1 ‡∏•‡∏π‡∏Å‡∏à‡∏≤‡∏Å‡∏ñ‡∏∏‡∏á ‡πÅ‡∏î‡∏á 1 ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô 2 ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß 3 ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£?", opts:["1/2","1/3","2/3"], a:0 },
      { q:"‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏Ç 1-10 ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡πÑ‡∏î‡πâ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞ (2,3,5,7) ‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£?", opts:["2/5","1/2","3/10"], a:0 },
    ]
  };

  function pickDifficulty(type){
    if (type === "gold") return "hard";
    if (type === "fishB") return "medium";
    return "easy";
  }

  let quizTimer = null;
  let quizTimeLeft = 45;

  function stopQuizTimer(){
    if (quizTimer){
      clearInterval(quizTimer);
      quizTimer = null;
    }
  }

  function lockQuizChoices(){
    [...quizChoices.querySelectorAll("button")].forEach(x => x.disabled = true);
    skipBtn.disabled = true;
  }

  function closeQuizToIdle(){
    quizOverlay.classList.remove("show");
    setState(ST.IDLE);
    log("üéØ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏î Cast ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏Å‡∏õ‡∏•‡∏≤‡∏≠‡∏µ‡∏Å‡∏£‡∏≠‡∏ö");
  }

  function showWin(){
    stopQuizTimer();
    setState(ST.WIN);
    quizBadge.textContent = "üéâ ‡∏ä‡∏ô‡∏∞‡πÅ‡∏•‡πâ‡∏ß!";
    quizTitle.textContent = "‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏ô‡∏∞‡πÄ‡∏Å‡∏°!";
    quizQuestion.innerHTML = `<div class="winTitle">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ñ‡∏∂‡∏á 5 ‡πÅ‡∏•‡πâ‡∏ß ‚úÖ</div>‡∏≠‡∏¢‡∏≤‡∏Å‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏Å‡∏î Reset ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢`;
    quizChoices.innerHTML = "";
    const b = document.createElement("button");
    b.className = "choiceBtn";
    b.textContent = "‚Üª Reset (‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà)";
    b.onclick = () => resetGame();
    quizChoices.appendChild(b);
    quizResult.textContent = "";
    quizOverlay.classList.add("show");
    log("üèÜ ‡∏ä‡∏ô‡∏∞‡πÅ‡∏•‡πâ‡∏ß! ‡∏Å‡∏î Reset ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà");
  }

  function showQuiz(type){
    setState(ST.QUIZ);

    const diff = pickDifficulty(type);
    const pool = QUIZ[diff];
    const item = pool[Math.floor(Math.random() * pool.length)];

    quizBadge.textContent = `${fishLabel(type)} ‚Ä¢ ‡∏£‡∏∞‡∏î‡∏±‡∏ö: ${diff === "easy" ? "‡∏á‡πà‡∏≤‡∏¢" : diff === "medium" ? "‡∏Å‡∏•‡∏≤‡∏á" : "‡∏¢‡∏≤‡∏Å"}`;
    quizTitle.textContent = "‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö +1 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô";
    quizQuestion.textContent = item.q;
    quizResult.textContent = "";

    stopQuizTimer();
    quizTimeLeft = 45;
    quizTimeEl.textContent = quizTimeLeft;

    quizChoices.innerHTML = "";
    item.opts.forEach((opt, idx) => {
      const b = document.createElement("button");
      b.className = "choiceBtn";
      b.textContent = `${String.fromCharCode(65+idx)}. ${opt}`;
      b.onclick = () => {
        lockQuizChoices();
        stopQuizTimer();

        const correct = (idx === item.a);
        if (correct){
          score += 1;
          quizResult.textContent = "‚úÖ ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! +1 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô";
          log(`‚úÖ ‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å! ‡πÑ‡∏î‡πâ 1 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡∏ï‡∏≠‡∏ô‡∏à‡∏±‡∏ö ${fishLabel(type)})`);
        } else {
          quizResult.textContent = "‚ùå ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å ‡πÑ‡∏î‡πâ 0 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô";
          log(`‚ùå ‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î (‡∏ï‡∏≠‡∏ô‡∏à‡∏±‡∏ö ${fishLabel(type)})`);
        }

        updateUI();

        if (score >= 5){
          setTimeout(() => showWin(), 450);
          return;
        }
        setTimeout(() => closeQuizToIdle(), 650);
      };
      quizChoices.appendChild(b);
    });

    skipBtn.disabled = false;
    skipBtn.onclick = () => {
      lockQuizChoices();
      stopQuizTimer();
      quizResult.textContent = "‚è≠Ô∏è ‡∏Ç‡πâ‡∏≤‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° ‡πÑ‡∏î‡πâ 0 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô";
      log(`‚è≠Ô∏è ‡∏Ç‡πâ‡∏≤‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° (‡∏ï‡∏≠‡∏ô‡∏à‡∏±‡∏ö ${fishLabel(type)})`);
      updateUI();

      if (score >= 5){
        setTimeout(() => showWin(), 450);
        return;
      }
      setTimeout(() => closeQuizToIdle(), 650);
    };

    quizTimer = setInterval(() => {
      quizTimeLeft -= 1;
      quizTimeEl.textContent = quizTimeLeft;

      if (quizTimeLeft <= 0){
        lockQuizChoices();
        stopQuizTimer();
        quizResult.textContent = "‚è±Ô∏è ‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤ ‡πÑ‡∏î‡πâ 0 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô";
        log(`‚è±Ô∏è ‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤ (‡∏ï‡∏≠‡∏ô‡∏à‡∏±‡∏ö ${fishLabel(type)})`);
        updateUI();
        setTimeout(() => closeQuizToIdle(), 650);
      }
    }, 1000);

    quizOverlay.classList.add("show");
  }

  function spawnFish(){
    const types = ["normal","fishA","fishB","gold"];
    const type = types[Math.floor(Math.random()*types.length)];
    const y = waterLine() + canvas.height * (0.18 + Math.random()*0.62);
    const dir = Math.random() < 0.5 ? -1 : 1;
    const speed = (type === "gold" ? 0.9 : type === "fishB" ? 1.05 : 1.1) * (0.8 + Math.random()*1.2);
    fishes.push({
      type,
      x: dir === 1 ? -80 : canvas.width + 80,
      y,
      dir,
      speed,
      bob: Math.random()*Math.PI*2,
      size: type === "gold" ? 22 : 20
    });
    if (fishes.length > 14) fishes.shift();
  }

  function cast(){
    if (!(state === ST.IDLE || state === ST.BROKE)) return;

    hook.x = rod.x + 80;
    hook.y = rod.y + 30;
    hook.vy = 0;

    hookedFish = null;
    targetType = null;
    tension = 0;
    fishPull = 0;
    updateTensionUI();

    setState(ST.CASTING);
    castTimer = 0;
    log("üéØ ‡πÄ‡∏´‡∏ß‡∏µ‡πà‡∏¢‡∏á‡πÄ‡∏ö‡πá‡∏î!");

    targetType = rollFishType();
    waitTimer = 750 + Math.random()*1250;
  }

  // ===== ‚úÖ REEL controls (‡∏ä‡∏±‡∏ß‡∏£‡πå: Mac trackpad + iPhone/Android) =====
  function tryOn(){ setReel(true); }
  function tryOff(){ if (!reelToggle) setReel(false); }

  // pointer ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏° mouse+touch+trackpad
  reelBtn.addEventListener("pointerdown", (e) => {
    if (reelBtn.disabled) return;
    e.preventDefault();
    if (!reelToggle) tryOn();
    try { reelBtn.setPointerCapture(e.pointerId); } catch(_) {}
  }, { passive:false });

  reelBtn.addEventListener("pointerup", (e) => {
    if (reelBtn.disabled) return;
    e.preventDefault();
    tryOff();
    try { reelBtn.releasePointerCapture(e.pointerId); } catch(_) {}
  }, { passive:false });

  reelBtn.addEventListener("pointercancel", () => {
    if (!reelToggle) setReel(false);
  });

  // click = toggle (‡πÅ‡∏Å‡πâ‡∏Å‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏¢‡∏≤‡∏Å)
  reelBtn.addEventListener("click", (e) => {
    if (reelBtn.disabled) return;
    e.preventDefault();
    reelToggle = !reelToggle;
    setReel(reelToggle);
  });

  // ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏ô‡∏≠‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏Å‡πá OFF ‡πÑ‡∏î‡πâ
  window.addEventListener("pointerup", () => { tryOff(); }, { passive:true });

  // ‡∏Å‡∏±‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á‡∏ï‡∏≠‡∏ô‡∏™‡∏•‡∏±‡∏ö‡πÅ‡∏ó‡πá‡∏ö/‡∏´‡∏•‡∏∏‡∏î‡πÇ‡∏ü‡∏Å‡∏±‡∏™
  window.addEventListener("blur", () => { reelToggle = false; setReel(false); });

  // ‡∏Ñ‡∏µ‡∏¢‡πå‡∏ö‡∏≠‡∏£‡πå‡∏î: R = toggle, C = cast
  window.addEventListener("keydown", (e) => {
    const k = e.key.toLowerCase();
    if (k === "c") cast();
    if (k === "r" && state === ST.HOOKED && !e.repeat){
      reelToggle = !reelToggle;
      setReel(reelToggle);
    }
  });

  castBtn.addEventListener('click', cast);

  function resetGame(){
    stopQuizTimer();
    quizOverlay.classList.remove("show");

    score = 0;
    normalCount = 0;
    fishACount = 0;
    fishBCount = 0;
    goldCount = 0;
    totalCount = 0;

    logEl.textContent = "- ‡∏Å‡∏î Cast ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°";
    tension = 0;
    updateTensionUI();
    updateUI();
    setState(ST.IDLE);
  }
  resetBtn.addEventListener('click', resetGame);

  function landed(){
    totalCount++;
    if (targetType === "gold") goldCount++;
    else if (targetType === "fishA") fishACount++;
    else if (targetType === "fishB") fishBCount++;
    else normalCount++;

    updateUI();
    setState(ST.LANDED);

    tension = 0;
    updateTensionUI();

    log(`üé£ ‡∏à‡∏±‡∏ö‡πÑ‡∏î‡πâ ${fishLabel(targetType)} ‚Äî ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°...`);
    setTimeout(() => showQuiz(targetType), 350);
  }

  function breakLine(){
    setState(ST.BROKE);
    log("üí• ‡∏™‡∏≤‡∏¢‡∏Ç‡∏≤‡∏î! ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà (‡∏Ñ‡∏∏‡∏° Reel ‡πÉ‡∏´‡πâ‡∏û‡∏≠‡∏î‡∏µ)");
    tension = 0;
    updateTensionUI();
  }

  function drawSea(){
    const g = ctx.createRadialGradient(canvas.width*0.7, canvas.height*0.05, 10, canvas.width*0.7, canvas.height*0.05, canvas.width*0.6);
    g.addColorStop(0, "rgba(255,255,255,0.12)");
    g.addColorStop(1, "rgba(255,255,255,0)");
    ctx.fillStyle = g;
    ctx.fillRect(0,0,canvas.width,canvas.height);

    ctx.fillStyle = "rgba(255,255,255,0.07)";
    ctx.fillRect(0, waterLine()-2, canvas.width, 2);

    for(let i=0;i<6;i++){
      const x = (i*0.17 + (Date.now()/5000)%1) * canvas.width;
      const y = waterLine() + canvas.height*(0.2 + (i*0.11)%0.6);
      ctx.beginPath();
      ctx.arc(x, y, 6 + (i%3), 0, Math.PI*2);
      ctx.strokeStyle = "rgba(255,255,255,0.12)";
      ctx.lineWidth = 2;
      ctx.stroke();
    }
  }

  function drawRodAndLine(){
    ctx.lineCap = "round";
    ctx.strokeStyle = "rgba(255,255,255,0.7)";
    ctx.lineWidth = 6;
    ctx.beginPath();
    ctx.moveTo(rod.x, rod.y);
    ctx.lineTo(rod.x + 90, rod.y - 30);
    ctx.stroke();

    ctx.strokeStyle = "rgba(219,234,254,0.85)";
    ctx.lineWidth = 2;
    const tipX = rod.x + 90, tipY = rod.y - 30;
    ctx.beginPath();
    ctx.moveTo(tipX, tipY);
    const midX = (tipX + hook.x)/2 + (tension*40);
    const midY = (tipY + hook.y)/2 + (tension*35);
    ctx.quadraticCurveTo(midX, midY, hook.x, hook.y);
    ctx.stroke();

    ctx.strokeStyle = "rgba(255,255,255,0.9)";
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.arc(hook.x, hook.y, 8, Math.PI*0.15, Math.PI*1.25);
    ctx.stroke();

    ctx.beginPath();
    ctx.moveTo(hook.x+3, hook.y+8);
    ctx.lineTo(hook.x+10, hook.y+12);
    ctx.stroke();

    ctx.fillStyle = "rgba(255,255,255,0.9)";
    ctx.beginPath();
    ctx.arc(hook.x-2, hook.y-2, 3, 0, Math.PI*2);
    ctx.fill();
  }

  function fishColors(type){
    if (type === "gold") return ["rgba(255,220,120,0.95)","rgba(255,150,70,0.95)"];
    if (type === "fishA") return ["rgba(170,255,220,0.95)","rgba(70,210,160,0.95)"];
    if (type === "fishB") return ["rgba(255,190,230,0.95)","rgba(200,120,255,0.95)"];
    return ["rgba(140,210,255,0.95)","rgba(80,140,255,0.95)"];
  }

  function drawFish(f){
    const bob = Math.sin(f.bob) * 5;
    const x = f.x;
    const y = f.y + bob;
    const s = f.size;

    const cols = fishColors(f.type);
    let body = ctx.createLinearGradient(x - s, y, x + s, y);
    body.addColorStop(0, cols[0]);
    body.addColorStop(1, cols[1]);

    ctx.save();
    ctx.translate(x, y);
    ctx.scale(f.dir, 1);

    ctx.fillStyle = body;
    ctx.beginPath();
    ctx.ellipse(0, 0, s*1.2, s*0.75, 0, 0, Math.PI*2);
    ctx.fill();

    ctx.fillStyle = "rgba(255,255,255,0.18)";
    ctx.beginPath();
    ctx.moveTo(-s*1.2, 0);
    ctx.lineTo(-s*1.9, -s*0.55);
    ctx.lineTo(-s*1.9, s*0.55);
    ctx.closePath();
    ctx.fill();

    ctx.fillStyle = "rgba(255,255,255,0.14)";
    ctx.beginPath();
    ctx.moveTo(0, 0);
    ctx.quadraticCurveTo(-s*0.2, -s*0.9, s*0.6, -s*0.5);
    ctx.closePath();
    ctx.fill();

    ctx.fillStyle = "rgba(255,255,255,0.9)";
    ctx.beginPath();
    ctx.arc(s*0.6, -s*0.15, 3.3, 0, Math.PI*2);
    ctx.fill();
    ctx.fillStyle = "rgba(0,0,0,0.75)";
    ctx.beginPath();
    ctx.arc(s*0.7, -s*0.15, 1.6, 0, Math.PI*2);
    ctx.fill();

    ctx.restore();
  }

  function drawHUD(){
    ctx.fillStyle = "rgba(255,255,255,0.85)";
    ctx.font = `${Math.max(12, canvas.width/75)}px system-ui`;
    ctx.fillText("‡∏ä‡∏ô‡∏∞‡∏ó‡∏µ‡πà 5 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ñ‡∏π‡∏Å)", 14, 24);

    ctx.fillStyle = "rgba(255,255,255,0.75)";
    ctx.fillText("‡∏õ‡∏•‡∏≤: ‡∏õ‡∏•‡∏≤‡∏ó‡∏≠‡∏á 1/10 ‚Ä¢ ‡∏õ‡∏•‡∏≤‡πÄ‡∏á‡∏¥‡∏ô 2/10 ‚Ä¢ ‡∏õ‡∏•‡∏≤‡∏ó‡∏≠‡∏á‡πÅ‡∏î‡∏á 3/10 ‚Ä¢ ‡∏õ‡∏•‡∏≤‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤ 4/10", 14, 46);

    if (state === ST.HOOKED){
      ctx.fillStyle = "rgba(255,255,255,0.9)";
      ctx.fillText("‡∏ï‡∏¥‡∏î‡∏õ‡∏•‡∏≤‡πÅ‡∏•‡πâ‡∏ß! ‡∏Ñ‡∏•‡∏¥‡∏Å Reel = ‡∏Ñ‡πâ‡∏≤‡∏á ON", 14, 70);
    } else if (state === ST.WAITING){
      ctx.fillStyle = "rgba(255,255,255,0.75)";
      ctx.fillText("‡∏£‡∏≠‡∏õ‡∏•‡∏≤‚Ä¶", 14, 70);
    }
  }

  let last = performance.now();

  function tick(now){
    const dt = Math.min(33, now - last);
    last = now;

    if (Math.random() < 0.02) spawnFish();
    for (const f of fishes){
      f.bob += dt/500;
      f.x += f.dir * f.speed * (dt/5);
    }

    if (state === ST.QUIZ || state === ST.WIN){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      drawSea();
      for (const f of fishes){
        if (f.y > waterLine() + 10) drawFish(f);
      }
      drawRodAndLine();
      drawHUD();
      requestAnimationFrame(tick);
      return;
    }

    if (state === ST.CASTING){
      castTimer += dt;
      hook.vy += 0.0012 * dt;
      hook.y += hook.vy * dt;

      const targetY = waterLine() + canvas.height*0.35;
      if (hook.y > targetY){
        hook.y = targetY;
        hook.vy = 0;
        setState(ST.WAITING);
        log("üåä ‡πÄ‡∏´‡∏¢‡∏∑‡πà‡∏≠‡∏à‡∏°‡∏•‡∏á‡πÅ‡∏•‡πâ‡∏ß‚Ä¶ ‡∏£‡∏≠‡∏õ‡∏•‡∏≤‡∏Å‡∏¥‡∏ô");
      }
    }
    else if (state === ST.WAITING){
      waitTimer -= dt;
      hook.x = (rod.x + 80) + Math.sin(now/600)*10;

      if (waitTimer <= 0){
        setState(ST.HOOKED);
        hookedFish = {
          type: targetType,
          x: hook.x + 90,
          y: hook.y + 40,
          dir: -1,
          speed: (targetType === "gold" ? 1.08 : targetType === "fishB" ? 1.04 : 1.0),
          bob: Math.random()*Math.PI*2,
          size: (targetType === "gold" ? 26 : 24),
          hooked: true
        };
        log(`üéØ ‡∏ï‡∏¥‡∏î‡∏õ‡∏•‡∏≤‡πÅ‡∏•‡πâ‡∏ß! (${fishLabel(targetType)})`);
      }
    }
    else if (state === ST.HOOKED){
  // ===== üü¢ EASY MODE: ‡∏à‡∏±‡∏ö‡∏á‡πà‡∏≤‡∏¢‡∏°‡∏≤‡∏Å =====

  // 1) tension ‡πÅ‡∏ó‡∏ö‡πÑ‡∏°‡πà‡∏Ç‡∏∂‡πâ‡∏ô (‡∏™‡∏≤‡∏¢‡πÑ‡∏°‡πà‡∏Ç‡∏≤‡∏î)
  tension += (reelHeld ? 0.00015 : 0.00002) * dt;
  tension -= 0.0012 * dt;
  tension = Math.max(0, Math.min(1, tension));

  // 2) ‡∏¢‡∏Å‡πÄ‡∏ö‡πá‡∏î‡πÅ‡∏£‡∏á‡∏°‡∏≤‡∏Å ‡∏Å‡∏î Reel = ‡∏Ç‡∏∂‡πâ‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
  const reelLift = reelHeld ? 0.0065 : 0.0003;
  if (reelHeld){
    hook.y -= reelLift * dt;
  } else {
    hook.y += 0.0006 * dt;
  }
  hook.y = Math.max(rod.y - 15, Math.min(canvas.height - 30, hook.y));

  // 3) ‡∏õ‡∏•‡∏≤‡πÄ‡∏Å‡∏≤‡∏∞‡πÄ‡∏ö‡πá‡∏î‡πÅ‡∏ô‡πà‡∏ô ‡∏ï‡∏≤‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
  if (hookedFish){
    hookedFish.x += (hook.x - hookedFish.x) * 0.08;
    hookedFish.y += (hook.y - hookedFish.y) * 0.08;
  }

  // 4) ‡∏à‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢‡∏°‡∏≤‡∏Å
  if (hook.y <= rod.y + 35){
    landed();
  }

  updateTensionUI();
}



    ctx.clearRect(0,0,canvas.width,canvas.height);
    drawSea();

    for (const f of fishes){
      if (f.y > waterLine() + 10) drawFish(f);
    }

    if (hookedFish && state === ST.HOOKED){
      drawFish(hookedFish);
      const dx = (hookedFish.x - hook.x);
      const dy = (hookedFish.y - hook.y);
      hookedFish.x -= dx * 0.002 * dt;
      hookedFish.y -= dy * 0.002 * dt;
    }

    drawRodAndLine();
    drawHUD();
    requestAnimationFrame(tick);
  }

  setState(ST.IDLE);
  updateTensionUI();
  updateUI();
  requestAnimationFrame(tick);
})();
</script>
</body>
</html>
